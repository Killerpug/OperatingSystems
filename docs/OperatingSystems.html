<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Operating System Engineering MIT</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left data-line-1">
<div id="header">
<h1>Operating System Engineering MIT</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview_of_topics">1. Overview of topics</a></li>
<li><a href="#_a_little_history">2. A little history</a></li>
<li><a href="#_fundamentals">3. Fundamentals</a>
<ul class="sectlevel2">
<li><a href="#_computer_architecture">3.1. Computer Architecture</a>
<ul class="sectlevel3">
<li><a href="#_executing_instructions">3.1.1. Executing instructions:</a></li>
<li><a href="#_types_of_data_transfering">3.1.2. Types of Data transfering</a></li>
<li><a href="#_startup">3.1.3. Startup:</a></li>
<li><a href="#_interruptsexceptions">3.1.4. Interrupts/exceptions:</a></li>
</ul>
</li>
<li><a href="#_what_is_an_operating_system">3.2. What is an operating system?</a>
<ul class="sectlevel4">
<li><a href="#_os_responsibilities">OS Responsibilities</a></li>
</ul>
</li>
<li><a href="#_os_organization">3.3. OS Organization</a>
<ul class="sectlevel3">
<li><a href="#_user_mode_supervisor_mode_and_system_calls">3.3.1. User mode, supervisor mode and system calls</a></li>
<li><a href="#_abstracting_physical_resources">3.3.2. Abstracting physical resources</a></li>
<li><a href="#_kernel">3.3.3. Kernel</a>
<ul class="sectlevel4">
<li><a href="#_kernel_design">Kernel design</a></li>
<li><a href="#_how_is_xv6_kernel_organized_booting_up_xv6">How is XV6-Kernel Organized: booting up XV6</a></li>
</ul>
</li>
<li><a href="#_system_calls">3.3.4. System calls</a></li>
<li><a href="#_process_and_threads">3.3.5. Process and Threads</a>
<ul class="sectlevel4">
<li><a href="#_analogy_for_processes_and_threads">Analogy for processes and threads</a></li>
<li><a href="#_process">Process</a></li>
<li><a href="#_thread">Thread</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_os_interfaces">3.4. OS Interfaces</a>
<ul class="sectlevel3">
<li><a href="#_file_descriptors_for_io">3.4.1. File descriptors for I/O</a>
<ul class="sectlevel4">
<li><a href="#_reading_and_writing_into_a_file">Reading and writing into a file</a></li>
</ul>
</li>
<li><a href="#_pipes">3.4.2. Pipes</a></li>
<li><a href="#_file_system_and_links">3.4.3. File system and links</a>
<ul class="sectlevel4">
<li><a href="#_file_system">File system</a></li>
<li><a href="#_links">Links</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_memory_management">3.5. Memory Management</a></li>
<li><a href="#_virtualization_vs_interpretation">3.6. Virtualization Vs Interpretation:</a></li>
</ul>
</li>
<li><a href="#_page_tables">4. Page tables</a>
<ul class="sectlevel2">
<li><a href="#_paging_hardware">4.1. Paging hardware</a></li>
</ul>
</li>
<li><a href="#_terminology">5. Terminology</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1 data-line-11">
<h2 id="_overview_of_topics">1. Overview of topics</h2>
<div class="sectionbody">
<div class="paragraph data-line-12">
<p>Topics include:</p>
</div>
<div class="olist arabic data-line-14">
<ol class="arabic">
<li class="data-line-14">
<p>Design and implementation of operating systems, and their use as a foundation for systems programming.</p>
</li>
<li class="data-line-15">
<p>RISC-V</p>
</li>
<li class="data-line-16">
<p>Virtual memory</p>
</li>
<li class="data-line-17">
<p>File systems</p>
</li>
<li class="data-line-18">
<p>Threads</p>
</li>
<li class="data-line-19">
<p>Context switches</p>
</li>
<li class="data-line-20">
<p>Kernels</p>
</li>
<li class="data-line-21">
<p>Interrupts</p>
</li>
<li class="data-line-22">
<p>System calls</p>
</li>
<li class="data-line-23">
<p>Interprocess communication</p>
</li>
<li class="data-line-24">
<p>Coordination, and interaction between software and hardware.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-26">
<p>A multi-processor operating system for RISC-V, <strong>xv6</strong>, is used to illustrate these topics. Assignments involve extending the xv6 operating system, which resembles to unix v6, for example to support sophisticated virtual memory features and networking.</p>
</div>
<div class="paragraph data-line-28">
<p><strong>Projects:</strong></p>
</div>
<div class="ulist data-line-30">
<ul>
<li class="data-line-30">
<p>Network driver that sends packets over the internet</p>
</li>
<li class="data-line-31">
<p>Redesign memory allocator for scaling across multiple cores.</p>
</li>
<li class="data-line-32">
<p>Implement fork and make it efficient via copy-on-write.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1 data-line-37">
<h2 id="_a_little_history">2. A little history</h2>
<div class="sectionbody">
<div class="paragraph data-line-39">
<p><strong>1945-1955</strong> vacuum tubes and punching cards.</p>
</div>
<div class="paragraph data-line-41">
<p><strong>1955-65</strong>: Transistors and batch systems:</p>
</div>
<div class="paragraph data-line-43">
<p>Batch systems accumulate many jobs into tape and run all the tape at once. Separation between designers, operators, programmers(assembly or Fortran) and maintenance.</p>
</div>
<div class="paragraph data-line-45">
<p><strong>1965-80</strong>: ICs, multiprogramming and the birth of UNIX and Microsoft:</p>
</div>
<div class="paragraph data-line-47">
<p>In the 1960s, Moore’s Law predicted that the number of transistors on an integrated circuit would <strong>double every eighteen months</strong>.</p>
</div>
<div class="paragraph data-line-49">
<p>The <strong>IBM 360</strong> (A <span class="underline">family of compatible computers</span> that ranged from low to high performance were built to satisfy the growth of the programs of the client), had the goal achieving compatibility of programs across the family of computers that share the same architecture, however that <span class="red">required that the piece of code called "operating system" meet all the conflict requirements</span> for scientific and commercial environments, which obviously resulted in thousands of bugs in assembly code; but managed to satisfied most of the customers reasonably well. They popularized several key techniques like the multiprogramming to <strong>keep computer working 100% of the time by keeping 3 jobs</strong> on different memories, utilizing the idle time that the CPU waited for IO for another job.</p>
</div>
<div class="paragraph data-line-51">
<p><strong>(1974) 8080 First general-purpose 8-bit Intel CPU</strong>. Kildall wrote the OS and found Digital Research, but a killing decision of not writing an OS for IBM in 1980 led Seattle Computer Products to create DOS(Disk Operating System) and Bill Gates hired <strong>Tim Patterson</strong> to revise it, becoming <strong>MS-DOS</strong>.</p>
</div>
<div class="paragraph data-line-53">
<p>Doug at Standford Research did some research on GUIs and Xerox PARC adopted into the machines they built, <strong>Steve Jobs saw them and embarked on building an Apple with a GUI(LISA)</strong>. Second attempt succeeded because it was user friendly, meaning that it was <span class="red"><strong>intended for users who not only knew nothing about computers but furthermore had absolutely no intention whatsoever of learning</strong></span>. Apple inspire Windows 95, the first freestanding version of a GUI built into a modified MS-DOS.</p>
</div>
<div class="paragraph data-line-55">
<p><strong>MULTICS</strong> was developed as a way to <strong>share a computer across multiple users</strong>(yes this is where cloud computing started) and it was a success because people knew how to write small, efficient programs(a skill that has been lost). However this effort did not take over the world because it was written in PL/I which was an obsolete compiler but many discoveries helped to develop UNIX OS.
<strong>UNIX began with a MULTICS</strong> version and grew into multiple incompatible versions, which led to the development of the <strong>POSIX standard by the IEEE that standardizes interfaces to run a program into any UNIX system</strong>.</p>
</div>
<div class="paragraph data-line-58">
<p><strong>1980-Present</strong>: Personal Computers MINIMIX(1987) and Linux:</p>
</div>
<div class="paragraph data-line-60">
<p>The detection and replacement of faulty/crashed modules on the fly without a reboot or disturbing running programs was its goal: reliability, dependability and availability. This system is described on Operating Systems Design and implementation (Tanenbaum &amp; Woodhull).</p>
</div>
<div class="paragraph data-line-62">
<p>Minimix led to <strong>Linux</strong>, a free production OS created by Linus Torvalds.
With the development of Large Scale Integration circuits, chips containing thousands of transistors, personal computers became affordable.</p>
</div>
</div>
</div>
<div class="sect1 data-line-69">
<h2 id="_fundamentals">3. Fundamentals</h2>
<div class="sectionbody">
<div class="paragraph data-line-70">
<p>A computer consist of one or more processors, main memory, registers, IO devices, memory controller and other physical components; all in one complex system as shown.</p>
</div>
<div class="imageblock data-line-73">
<div class="content">
<img src="images/1_armCore.jpg" alt="1 armCore">
</div>
<div class="title">Figure 1. ARM microcontroller</div>
</div>
<div class="paragraph data-line-75">
<p>The basic cycle of every CPU is to <a href="#fetch-instruction">fetch instructions</a> the first instruction from memory, decode it to determine its type and operands, execute it, and then fetch, decode, and execute subsequent instructions. The set of instructions(ISA) is <span class="red">specific to the architecture of the CPU</span>, so if every application had to understand how all these things work in detail, no code would be portable. Furthermore, managing all these components optimally is challenging. This is the reason computers have a software layer called <strong>operating system</strong>, whose job is to provide handling of this computer model <span class="green"><strong>making the applications reusable and also needing to write the OS only once per CPU architecture.</strong></span></p>
</div>
<div class="sect2 data-line-78">
<h3 id="_computer_architecture">3.1. Computer Architecture</h3>
<div class="sect3 data-line-80">
<h4 id="_executing_instructions">3.1.1. Executing instructions:</h4>
<div class="paragraph data-line-81">
<p>A CPU can load instructions only from memory, so any programs to run must be stored there. General purpose computers run the program from r/w memory (RAM). Fetch instruction receives an instruction from ROM(Flash in this case) and uses load-store instructions to process data, <strong>load</strong> moves a word or byte from main memory to internal register within CPU and <strong>store</strong> moves the content of the register to main memory</p>
</div>
<div id="fetch-instruction" class="imageblock data-line-85">
<div class="content">
<img src="images/3_computerInstructions.jpg" alt="3 computerInstructions">
</div>
<div class="title">Figure 2. fetch instructions</div>
</div>
</div>
<div class="sect3 data-line-87">
<h4 id="_types_of_data_transfering">3.1.2. Types of Data transfering</h4>
<div class="paragraph data-line-89">
<p><strong>Interrupt Driven I/O:</strong></p>
</div>
<div class="paragraph data-line-91">
<p>The IO device send data to the device controller, which examines the contents, transfers the data and informs the CPU via interrupt(one interrupt per byte) that the IO device requires operation and the OS responds with the required operation. This works fine for small amounts of data. But produce high overhead when used for bulk data movement such as disk IO.</p>
</div>
<div class="paragraph data-line-93">
<p><strong>DMA:</strong></p>
</div>
<div class="paragraph data-line-95">
<p>After setting buffers, pointers and counters for IO device, device controller transfers an entire block of data directly to or from its own buffer storage to memory without CPU intervention(only one interrupt per block).</p>
</div>
</div>
<div class="sect3 data-line-98">
<h4 id="_startup">3.1.3. Startup:</h4>
<div class="paragraph data-line-99">
<p>When a computer its powered up or rebooted the bootloader runs, a simple program stored in ROM or EEPROM. It initializes all aspects of the system: from CPU registers to device controllers and memory contents. It also must know how to locate and load the OS and start executing the <strong>kernel</strong> (which is the program that runs all the time.)</p>
</div>
</div>
<div class="sect3 data-line-101">
<h4 id="_interruptsexceptions">3.1.4. Interrupts/exceptions:</h4>
<div class="ulist data-line-103">
<ul>
<li class="data-line-103">
<p>Hardware → physical signals either from peripherals or the cpu itself.</p>
</li>
<li class="data-line-104">
<p>Software → executing special operation called <strong>system call</strong>(provide means for a user to ask the OS to perform tasks reserved for the OS).</p>
</li>
</ul>
</div>
<div class="paragraph data-line-106">
<p><strong>General interrupt/exception process</strong></p>
</div>
<div class="paragraph data-line-108">
<p>When an exception or interrupt occurs, execution transition from user mode to kernel mode where the exception or interrupt is handled takes place as follows.</p>
</div>
<div id="interrupt-process" class="imageblock data-line-112">
<div class="content">
<img src="images/4_overviewInterrupt.jpg" alt="4 overviewInterrupt">
</div>
<div class="title">Figure 3. interrupt process overview</div>
</div>
<div class="paragraph data-line-114">
<p><strong>Interruption process on ARM microcontrollers:</strong></p>
</div>
<div class="paragraph data-line-116">
<p>1) To save the context:</p>
</div>
<div class="paragraph data-line-118">
<p>In parallel, save(push) the address of the interrupted instruction in the Program Counter. Also, we store status register(xPSR), LR and registers R0, R1, R2, R3 and R12.</p>
</div>
<div class="imageblock data-line-121">
<div class="content">
<img src="images/5_IRQsavestate.jpg" alt="5 IRQsavestate">
</div>
<div class="title">Figure 4. IRQ context switch</div>
</div>
<div class="paragraph data-line-123">
<p>2) Then, to handle the exception or interruption:</p>
</div>
<div class="paragraph data-line-125">
<p>Computer locates the IRQn on the vector table, which contains the <strong>address of the interrupt handler(ISR)</strong>. Finally, code on that handler function is executed and once its finished, the context is restored.</p>
</div>
<div class="imageblock data-line-128">
<div class="content">
<img src="images/6_ISRhandler.png" alt="6 ISRhandler">
</div>
<div class="title">Figure 5. ISR location on Vector table</div>
</div>
<div class="paragraph data-line-130">
<p>Since only a predefined number of interrupts is possible, a table of pointers to interrupt handling routines is commonly used to provide speed, this table of pointers is stored in low memory and is called interrupt vector (inside vector table).</p>
</div>
</div>
</div>
<div class="sect2 data-line-133">
<h3 id="_what_is_an_operating_system">3.2. What is an operating system?</h3>
<div class="paragraph data-line-134">
<p>An operating systems acts as an intermediary between the applications in a computer and the hardware(see <a href="#computer-stack">computer stack</a>, so its basically a driver). The OS is a program that manages a computers resources by offering services(cpu time, memory space via file storage, IO operations). An OS can be designed to be convenient or efficient but the <strong>main goals  of an OS are:</strong></p>
</div>
<div class="ulist data-line-136">
<ul>
<li class="data-line-136">
<p>Abstract: hardware for portability and convinience.</p>
</li>
<li class="data-line-137">
<p>Multiplexing: allow multiple applications to share hardware and cooperate while isolating programs to provide security.</p>
</li>
</ul>
</div>
<div class="sect4 data-line-139">
<h5 id="_os_responsibilities">OS Responsibilities</h5>
<div class="ulist data-line-141">
<ul>
<li class="data-line-141">
<p>Scheduling processes and threads on the CPUs. And allocating the pertinent resources.</p>
</li>
<li class="data-line-142">
<p>Creating and deleting both user and system processes.</p>
</li>
<li class="data-line-143">
<p>Suspending and resuming processes</p>
</li>
<li class="data-line-144">
<p>Providing mechanisms for process synchronization</p>
</li>
<li class="data-line-145">
<p>Providing mechanisms for process communication</p>
</li>
<li class="data-line-146">
<p>Keeping track of which parts of memory are currently being used and who is using them</p>
</li>
<li class="data-line-147">
<p>Deciding which processes (or parts of processes) and data to move into and out of memory</p>
</li>
<li class="data-line-148">
<p>Allocating and deallocating memory space as needed</p>
</li>
</ul>
</div>
<div class="admonitionblock note data-line-150">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Operating systems differ from user programs in location of residence, complexity, long-lived. The source code of Linux OS is on the order of 5 million lines of code. So <strong>Operative systems are hard to write, hence, not easy to replace.</strong>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-152">
<h3 id="_os_organization">3.3. OS Organization</h3>
<div class="paragraph data-line-153">
<p>We will see how OSs(mainly with monolithic kernels as xv6) are organized to acomplish: multiplexing, isolation and interaction of processes.</p>
</div>
<div id="computer-stack" class="imageblock data-line-157">
<div class="content">
<img src="images/2_OSoverview.jpg" alt="2 OSoverview">
</div>
<div class="title">Figure 6. computer stack</div>
</div>
<div class="sect3 data-line-159">
<h4 id="_user_mode_supervisor_mode_and_system_calls">3.3.1. User mode, supervisor mode and system calls</h4>
<div class="paragraph data-line-160">
<p>On top of the hardware is software, computers have two modes of operation(defined in the mode bit): <strong>kernel mode</strong>(0, fundamental piece of software, also called supervisor/privileged mode, which has complete access to ALL hardware and can execute ANY instruction: interrupts, read write address registers of page tables&#8230;&#8203;) and <strong>user mode</strong>(1, subset of instructions. Forbids any instruction that affect the control of the machine or does I/O).
This 2 modes are blurred in embedded systems, because they may not have an OS at all. Also some programs allow the users to help the OS or perform privileged functions(syscalls).</p>
</div>
<div class="paragraph data-line-163">
<p>You will see that <strong>system calls</strong> are the interface between user and kernel mode, they allow apps to invoke certain kernel functions like read. User/supervisor modes exist to achieve isolation applications, so that only OS runs in supervisor mode, apps are unable to modify OS data structures and instructions(hence other apps/processes memories).</p>
</div>
</div>
<div class="sect3 data-line-165">
<h4 id="_abstracting_physical_resources">3.3.2. Abstracting physical resources</h4>
<div class="paragraph data-line-166">
<p>Resource abstraction into services is typical to enable strong isolation  between applications that require access to sensitive hardware resources. For example, File systems "open, read, write, close" system calls provide  abstraction for reading and writing to the memory disk. This way, the <strong>OS is able to manage the physical-disk</strong> resource and <strong>apps have the convenience of pathnames</strong> when accessing the File System.</p>
</div>
<div class="paragraph data-line-168">
<p>Another example is the file descriptors systemcalls, they allow OS to decide where to place a pipe/file in memory and keeps away the app from interacting directly with memory while providing status signals(end-of-file, open file&#8230;&#8203;).  The system-call interface is designed to provide convenience and strong isolation.</p>
</div>
<div class="admonitionblock note data-line-170">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>Why abstracting?</strong> The operating system must assume that a process&#8217;s user-level code will do its best to wreck the kernel or other processes. User code may try to dereference pointers outside its allowed address space; it may attempt to execute any RISC-V instructions, even those not intended for user code; it may try to read and write any RISC-V control register; it may try to directly access device hardware; and it may pass clever values to system calls in an attempt to trick the kernel into crashing or doing something stupid. The <strong>kernel&#8217;s goal is to restrict each user processes so that all it can do is read/write/execute its own user memory, use the 32 general-purpose RISC-V registers, and only affect the kernel and other processes in the ways that system calls are intended to allow it</strong>. The kernel must prevent any other actions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-172">
<h4 id="_kernel">3.3.3. Kernel</h4>
<div class="paragraph data-line-173">
<p>XV6 OS takes the form of a kernel, a special program that provides services to running programs. A kernel has direct access to hardware components like RAM, CPU, DISK&#8230;&#8203; and it implements abstractions to that HW via modules/programs like: File system(tree directory, file contents), memory allocation, IO manager&#8230;&#8203; that provide common kernel services to different programs in user space as shown.</p>
</div>
<div class="imageblock data-line-176">
<div class="content">
<img src="images/9_kernel_services.jpg" alt="9 kernel services">
</div>
<div class="title">Figure 7. Kernel services</div>
</div>
<div class="sect4 data-line-178">
<h5 id="_kernel_design">Kernel design</h5>
<div class="paragraph data-line-179">
<p>A key design question is "what part of the OS should run in supervisor mode". There are 2 main posibilities:</p>
</div>
<div class="ulist data-line-181">
<ul>
<li class="data-line-181">
<p>Monolithic kernel: The entire OS resides in the kernel, so that all system calls run in supervisor mode.</p>
<div class="olist loweralpha data-line-182">
<ol class="loweralpha" type="a">
<li class="data-line-182">
<p>pros: doesn&#8217;t waste time on deciding which parts of OS need full HW privilege. Easier to cooperate between different parts(E.G. buffer and file system). Faster performance.</p>
</li>
<li class="data-line-183">
<p>cons: Interfaces between parts of the OS are often complex. Errors make entire kernel to fail.</p>
</li>
</ol>
</div>
</li>
<li class="data-line-185">
<p>Microkernel: Minimizes the amount of OS code that runs in supervisor mode. For example, the File system can run as a user-level process and apps that require file system can communicate via inter-process messages.</p>
<div class="olist loweralpha data-line-186">
<ol class="loweralpha" type="a">
<li class="data-line-186">
<p>pros: Relative simple organization(kernel consist of few low-level function for starting application, sending messages and accessing hardware). Separation of concerns. Most of OS resides in user-level servers. More reliable.</p>
</li>
<li class="data-line-187">
<p>cons: time overhead to pass messages and waiting for response.</p>
</li>
</ol>
</div>
</li>
<li class="data-line-189">
<p>Hibrid: the two methods above can be combined to deal with the tradeoffs of speed vs simplicity/reliability</p>
</li>
</ul>
</div>
<div class="imageblock data-line-192">
<div class="content">
<img src="images/OSO_kerneldesign_MonolithicVsMicrokernel.png" alt="OSO kerneldesign MonolithicVsMicrokernel">
</div>
<div class="title">Figure 8. Monolithic Kernel vs QNX Microkernel</div>
</div>
</div>
<div class="sect4 data-line-194">
<h5 id="_how_is_xv6_kernel_organized_booting_up_xv6">How is XV6-Kernel Organized: booting up XV6</h5>
<table class="tableblock frame-all grid-all stretch data-line-198">
<caption class="title">Table 1. kernel source files</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bio.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk block cache for the file system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">console.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to the user keyboard and screen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entry.S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Very first boot instructions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exec.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exec() system call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File descriptor support.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fs.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kalloc.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical page allocator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kernelvec.S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handle traps from kernel, and timer interrupts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File system logging and crash recovery.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">main.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control initialization of other modules during boot.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pipe.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pipes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">plic.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V interrupt controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">printf.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formatted output to the console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proc.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes and scheduling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sleeplock.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Locks that yield the CPU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spinlock.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Locks that don’t yield the CPU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Early machine-mode boot code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C string and byte-array library.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">swtch.S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thread switching.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">syscall.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dispatch system calls to handling function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sysfile.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File-related system calls.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sysproc.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process-related system calls.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trampoline.S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assembly code to switch between user and kernel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trap.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C code to handle and return from traps and interrupts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uart.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial-port console device driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">virtio_disk.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk device driver.</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vm.c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage page tables and address spaces.</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-229">
<p>When the RISC-V computer powers on, it starts in a bootloader stored in ROM, the bootloader loads XV6 kernel into memory(0x8000_0000) and in machine mode(configuration mode) XV6 starts at _entry. RISC-V starts with paging hardware disabled(virtual address maps directly to physical address).</p>
</div>
<div class="paragraph data-line-231">
<p>Instructions at _entry set up a stack for Early-machine boot code(in file start.c) and the stackpointer to stack0+4096(RISC-V grows down). On start, machine performs machine-mode only configurations(E.g. timer interrupts, pass responsabilities(memory access, interrupts and exceptions) to kernel mode) and switches to kernel mode by calling <strong>mret</strong>(This instruction is most often used to return from a previous call in supervisor mode to machine mode. Since start isn’t returning from such a call, instead we sets things up as if there had been one: setting the previous privilege mode to supervisor in the register mstatus, and return address to main by writing main’s address into the register <strong>mepc</strong>).</p>
</div>
<div class="paragraph data-line-233">
<p>Finally on Main(), we initialize several devices, subsystems, the first process by calling userinit(in proc.c, which executes the <strong>exec</strong> system call) and creates a new console device.</p>
</div>
</div>
</div>
<div class="sect3 data-line-235">
<h4 id="_system_calls">3.3.4. System calls</h4>
<div class="paragraph data-line-236">
<p>Programs can execute kernel services via system calls, which execute in a similar way to <a href="#interrupt-process">interrupt process overview</a> because systems calls are a special type of exceptions. <a href="#system-calls-xv6">Available system calls in xv6</a>, are the main interface for users to request  the execution of kernel resources (privileged-code that affects physical resources of the computer).</p>
</div>
<div class="paragraph data-line-238">
<p>Internally RISC-V provides <span class="green"><strong>ecall</strong></span> to switch from user to kernel mode at an entry point specified by the kernel. The kernel evalues ecall with syscall-number as a parameter(xv6 uses a7, syscall is basically a function pointer with all the valid system calls as described below).</p>
</div>
<div class="listingblock data-line-240">
<div class="content">
<pre class="highlight"><code class="language-C" data-lang="C">static uint64 (*syscalls[])(void) = {
[SYS_fork]    sys_fork,
[SYS_exit]    sys_exit,
[SYS_wait]    sys_wait,
[SYS_pipe]    sys_pipe,
[SYS_read]    sys_read,
[SYS_kill]    sys_kill,
[SYS_exec]    sys_exec,
[SYS_fstat]   sys_fstat,
[SYS_chdir]   sys_chdir,
[SYS_dup]     sys_dup,
[SYS_getpid]  sys_getpid,
[SYS_sbrk]    sys_sbrk,
[SYS_sleep]   sys_sleep,
[SYS_uptime]  sys_uptime,
[SYS_open]    sys_open,
[SYS_write]   sys_write,
[SYS_mknod]   sys_mknod,
[SYS_unlink]  sys_unlink,
[SYS_link]    sys_link,
[SYS_mkdir]   sys_mkdir,
[SYS_close]   sys_close,
};

void
syscall(void)
{
  int num;
  struct proc *p = myproc();

  num = p-&gt;trapframe-&gt;a7;
  if(num &gt; 0 &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) {
    p-&gt;trapframe-&gt;a0 = syscalls[num]();
  } else {
    printf("%d %s: unknown sys call %d\n",
            p-&gt;pid, p-&gt;name, num);
    p-&gt;trapframe-&gt;a0 = -1;
  }</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-283">
<h4 id="_process_and_threads">3.3.5. Process and Threads</h4>
<div class="sect4 data-line-285">
<h5 id="_analogy_for_processes_and_threads">Analogy for processes and threads</h5>
<div class="ulist data-line-287">
<ul>
<li class="data-line-287">
<p>A process as a house: A house is really a container, with certain attributes (such as the amount of floor space, the number of bedrooms, and so on). If you look at it that way, the house really doesn&#8217;t actively do anything on its own — it&#8217;s a passive object.</p>
</li>
<li class="data-line-288">
<p>The occupants as threads: The people living in the house are the active objects — they&#8217;re the ones using the various rooms, watching TV, cooking, taking showers, and so on.</p>
<div class="olist arabic data-line-289">
<ol class="arabic">
<li class="data-line-289">
<p><strong>Single threaded</strong>: If you&#8217;ve ever lived on your own, you know that you can do anything you want in the house at any time, because there&#8217;s nobody else in the house.</p>
</li>
<li class="data-line-290">
<p><strong>Multi threaded</strong>: Things change dramatically when you add another person into the house. Let&#8217;s say you get married, so now you have a spouse living there too. You can&#8217;t just march into the washroom at any given point; you need to check first to make sure your spouse isn&#8217;t in there. If you have two responsible adults living in a house, generally you can be reasonably lax about “security” — you know that the other adult will respect your space, won&#8217;t try to set the kitchen on fire (deliberately!), and so on.
Now, throw a few kids into the mix and suddenly things get a lot more interesting.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-294">
<div class="content">
<img src="images/8_proces_thread.png" alt="8 proces thread">
</div>
<div class="title">Figure 9. Process and thread</div>
</div>
</div>
<div class="sect4 data-line-296">
<h5 id="_process">Process</h5>
<div class="paragraph data-line-297">
<p>Each <strong>running program is called process</strong>, a process contains all the elements required to run and keep track of a program. A process allocates the following elements in <span class="green"><strong>proc</strong></span> structure:</p>
</div>
<div class="ulist data-line-299">
<ul>
<li class="data-line-299">
<p>A user and a kernel stack. Only one stack is actively used at a time and it depends on the instructions in execution(<strong>ecall</strong> raises privileges to kernel instructions and <strong>sret</strong> lowers privilege level to resume executing user instructions).</p>
</li>
<li class="data-line-300">
<p>heap</p>
</li>
<li class="data-line-301">
<p>code(user text and data)</p>
</li>
<li class="data-line-302">
<p>process identifier(pid),</p>
</li>
<li class="data-line-303">
<p>file descriptors</p>
</li>
<li class="data-line-304">
<p>page table, maps virtual addresses to physical addresses</p>
</li>
<li class="data-line-305">
<p>Trampoline and trapframes, used to transition in and out of the kernel. Trampoline is the code for transition and trapframe is a structure filled by trampoline to save/restore the state of the process.</p>
</li>
<li class="data-line-306">
<p>optionally inter-process communication(IPC) channels.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-308">
<p>The process implementation includes user/kernel mode flag, addresss space(own memory), and time slicing of threads mechanisms to create strong isolation. Isolation is achieved by creating the illusion to a program that is has its own private machine, a process only has access to a "private" address space which other processes cannot read or write.</p>
</div>
<div class="imageblock data-line-311">
<div class="content">
<img src="images/OSO_proccessAndThread_ProcessVirtualAddressSpace.png" alt="OSO proccessAndThread ProcessVirtualAddressSpace">
</div>
<div class="title">Figure 10. Layout of a process&#8217;s virtual address space</div>
</div>
<div class="paragraph data-line-313">
<p>XV6 uses page tables(implemented in HW) to give each process its own address space. RISC-V page table translates/maps a virtual address(in range  of 0 - 2^38 since HW only uses 38 bits when looking up virtual adresses in page tables) to a physical address. XV6 maintains separate page table for each process.</p>
</div>
<div class="paragraph data-line-315">
<p>At the top of the address space, XV6 reserves a page for trampoline(code to transition in and out the kernel) and a page for trapframe(structure with status-data of the process, filled by trampoline to save/restore the state of the process).</p>
</div>
<div class="sect5 data-line-317">
<h6 id="_process_states">process states</h6>
<div class="paragraph data-line-318">
<p>xv6 time-shares processes, this means that it transparently switches available CPU cores among the set of processes <strong>ready</strong> to execute processes. a process can be in either of the following states:</p>
</div>
<div class="ulist data-line-320">
<ul>
<li class="data-line-320">
<p>idle</p>
</li>
<li class="data-line-321">
<p>ready: the process is ready to be queued for CPU execution</p>
</li>
<li class="data-line-322">
<p>waiting: the process is not executing, it is waiting for a resource.</p>
</li>
</ul>
</div>
</div>
<div class="sect5 data-line-324">
<h6 id="_process_creation">process creation</h6>
<div class="paragraph data-line-325">
<p>a process may create a new process using <span class="green"><strong>fork</strong></span> system call. fork gives the new process exactly the same memory contents(instructions and data) as the calling process. After child is created, both process will execute the following instructions.</p>
</div>
<div class="listingblock data-line-326">
<div class="content">
<pre class="highlight"><code class="language-C" data-lang="C">int pid = fork();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4 data-line-331">
<h5 id="_thread">Thread</h5>
<div class="paragraph data-line-332">
<p>A thread is just the flow of execution or control within one process. A process thread has attributes like:</p>
</div>
<div class="ulist data-line-334">
<ul>
<li class="data-line-334">
<p>priority</p>
</li>
<li class="data-line-335">
<p>scheduling algorithm</p>
</li>
<li class="data-line-336">
<p>registers, CPU mask for multicore, signals and more</p>
</li>
</ul>
</div>
<div class="paragraph data-line-338">
<p>so that multiple threads can be execute within one mediator-process. Basically a process changes executing thread according to scheduling policy. Threads create the illusion that the process posess its own CPU.</p>
</div>
<div class="paragraph data-line-340">
<p>Switching between processes happen in a similar fashion, kernel suspends currently running thread and resumes another process&#8217;s thread. The thread also has a stack(local variables, function call return adress) and state(suspended/running status).</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-344">
<h3 id="_os_interfaces">3.4. OS Interfaces</h3>
<div class="paragraph data-line-345">
<p>The job of an operating system is to share a computer among multiple programs and to provide a more useful set of services than the hardware alone supports. An OS makes abstractions of hardware so that programs do not concern about underlying hardware and at the same time facilitate the interaction between programs&#8592;&#8594;OS.</p>
</div>
<div class="sect3 data-line-347">
<h4 id="_file_descriptors_for_io">3.4.1. File descriptors for I/O</h4>
<div class="paragraph data-line-348">
<p>A file descriptor(often refered as <strong>file</strong>) is a small integer representing a kernel-managed <span class="green"><strong>object that a process may read from or write to</strong></span>. File descriptors are obtained by opening a file, directory or device. xv6 uses file descriptor as an index into a per-process table, so that every process has a private space of file descriptors starting at zero. By convention, a process:</p>
</div>
<div class="ulist data-line-350">
<ul>
<li class="data-line-350">
<p>reads from file descriptor 0(standard input)</p>
</li>
<li class="data-line-351">
<p>writes to file descriptor 1(standard output)</p>
</li>
<li class="data-line-352">
<p>writes error messages to file descriptor 2(std error)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-354">
<p>by default, these are the file descriptors for the console. The shell exploit this convention to implement I/O redirection and pipelines(eg: echo hello | wordCount).</p>
</div>
<div class="sect4 data-line-356">
<h5 id="_reading_and_writing_into_a_file">Reading and writing into a file</h5>
<div class="paragraph data-line-357">
<p>Reading and writing is perform via system calls.</p>
</div>
<div class="ulist data-line-359">
<ul>
<li class="data-line-359">
<p>read(fd, buf, n): reads at most n bytes from the file descriptor fd, copies
them into buf, and returns the number of bytes read.</p>
<div class="ulist data-line-361">
<ul>
<li class="data-line-361">
<p>If no data is available, a read on a pipe waits for either data to be written or for all file descriptors referring to the write end to be closed; in the latter case, read will return 0, just as if the end of a data file had been reached.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-362">
<p>write(fd, buf, n):writes n bytes from buf to the file descriptor fd and returns the number of bytes written.</p>
<div class="ulist data-line-363">
<ul>
<li class="data-line-363">
<p>each write picks up where the previous one left off</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3 data-line-365">
<h4 id="_pipes">3.4.2. Pipes</h4>
<div class="paragraph data-line-366">
<p>A pipe is a small kernel buffer exposed to processes as a pair of file descriptors (reading-fd, writing-fd). Writing data to one end of the pipe makes that data available for reading from the other end of the pipe, this is the way inter-process communications happens.</p>
</div>
</div>
<div class="sect3 data-line-370">
<h4 id="_file_system_and_links">3.4.3. File system and links</h4>
<div class="sect4 data-line-371">
<h5 id="_file_system">File system</h5>
<div class="paragraph data-line-372">
<p>The directories form a tree, starting at a special directory called the root. A path like /a/b/c refers to the file or directory named c inside the directory named b inside the directory named a in the root directory /.</p>
</div>
<div class="paragraph data-line-374">
<p>Paths that don’t begin with / are evaluated relative to the calling process’s current directory, which can
be changed with the <strong>chdir()</strong> system call.</p>
</div>
<div class="paragraph data-line-377">
<p>There are system calls to create new files and directories: <strong>mkdir()</strong> creates a new directory, <strong>open()</strong>
with the O_CREATE flag creates a new data file, and <strong>mknod()</strong> creates a new device file.</p>
</div>
</div>
<div class="sect4 data-line-380">
<h5 id="_links">Links</h5>
<div class="paragraph data-line-381">
<p>A File-descriptor is also called <strong>inode</strong>, because it may have multiple names linking to the same object and some metadata. The <strong>link()</strong> system call creates another file-name referring to the same inode as an exist file.</p>
</div>
<div class="listingblock data-line-382">
<div class="content">
<pre class="highlight"><code class="language-C" data-lang="C">//Reading from or writing to "a" is the same as reading from or writing to "b". This is known as *symbolic links* in UNIX systems.
open("a", O_CREATE|O_WRONLY);
link("a", "b");</code></pre>
</div>
</div>
<div class="paragraph data-line-389">
<p>Finally, since file-descriptors/inodes have more information than name and some data, <strong>fstat()</strong> system call retrieves information from the inode that a file-name refers to. It
fills in a struct <strong>stat</strong>, defined in stat.h (kernel/stat.h) as:</p>
</div>
<div class="listingblock data-line-392">
<div class="content">
<pre class="highlight"><code class="language-C" data-lang="C">#define T_DIR 1 // Directory
#define T_FILE 2 // File
#define T_DEVICE 3 // Device

struct stat {
    int dev;        // File system’s disk device
    uint ino;       // Inode number(per-process table, id for the file descriptor)
    short type;     // Type of file(directory, file, device).
    short nlink;    // Number of links to file
    uint64 size;    // Size of file in bytes
};</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-407">
<h3 id="_memory_management">3.5. Memory Management</h3>
<div class="paragraph data-line-409">
<p><strong>A) Cache: </strong></p>
</div>
<div class="paragraph data-line-411">
<p>stores data so that future requests for that data can be served faster, the data stored in a cache might be the result of an earlier computation or a copy of data stored elsewhere. A cache hit occurs when the requested data can be found in a cache, while a cache miss occurs when it cannot. Cache hits are served by reading data from the cache, which is faster than recomputing a result or reading from a slower data store(ex. main memory); thus, the more requests that can be served from the cache, the faster the system performs(which is designed on the cache management).</p>
</div>
<div class="paragraph data-line-413">
<p>For instance, most systems have an instruction cache to hold the instructions expected to be executed next. Without this cache, the would have to wait several cycles CPU while an instruction was fetched from main memory. If multiple processes affect the local copy of value A in cache, we must make sure to update and control the access for the most recent value of A, this is called “cache coherency”.</p>
</div>
<div class="paragraph data-line-415">
<p><strong>C)	Main memory:</strong></p>
</div>
<div class="paragraph data-line-417">
<p>R/W memory, usually too small to store all needed programs and data permanently. Volatile storage. Usually implemented in DRAM.</p>
</div>
<div class="paragraph data-line-419">
<p><strong>D)	Virtual Memory:</strong></p>
</div>
<div class="paragraph data-line-421">
<p>scheme that enables users to run programs larger than actual physical memory. Allows to abstract memory into a large, uniform storage array.</p>
</div>
</div>
<div class="sect2 data-line-423">
<h3 id="_virtualization_vs_interpretation">3.6. Virtualization Vs Interpretation:</h3>
<div class="paragraph data-line-424">
<p><strong>Virtualization: </strong>Allows OS to run applications within other OS. However, this emulation comes at a heavy price, every machine-level instructions must be translated to the equivalent function on the target system which often results in several target instructions.(An example of Virtual machine is Vmware or Vbox)</p>
</div>
<div class="imageblock data-line-427">
<div class="content">
<img src="images/7_virtualization.jpg" alt="7 virtualization">
</div>
<div class="title">Figure 11. virtualization</div>
</div>
<div class="paragraph data-line-429">
<p><strong>Interpretation:</strong> another type of emulation occurs when a computer language is not compiled to native code but instead is either executed in its high-level form or translated to an intermediate form. This is known as interpretation(Java is always interpreted, thats why we require a Java Virtual Machine).</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-433">
<h2 id="_page_tables">4. Page tables</h2>
<div class="sectionbody">
<div class="paragraph data-line-434">
<p>Page tables are the most popular mechanism through which the operating system provides each process with its own private address space and memory. They allow xv6 to isolate different process&#8217;s address spaces and to multiplex them onto a single physical memory.</p>
</div>
<div class="sect2 data-line-436">
<h3 id="_paging_hardware">4.1. Paging hardware</h3>
<div class="paragraph data-line-437">
<p>RISC-V instructions (both user and kernel) manipulate virtual addresses. Since the machine&#8217;s RAM, or physical memory is indexed with physical addresses, RISC-V provides page-table hardware as the bridge between the virtual and physical addressses.</p>
</div>
<div class="paragraph data-line-439">
<p>A page table is stored in physical memory as a 3-level tree structure. So the process of translating a virtual address into a physical is as follows(see <a href="#pagetable-addresstranslation">riscv pagetable address-translation</a>):</p>
</div>
<div class="olist arabic data-line-441">
<ol class="arabic">
<li class="data-line-441">
<p>The first level(root tree) contains 512 Page Table Entries, which contain the Physical Page Number(PPN) for page-table in the next level.
.
virtual addresses use 39 bits out of the 64-bit(because XV6 runs with Sv39 RISC-V ISA):</p>
<div class="ulist data-line-444">
<ul>
<li class="data-line-444">
<p>The top 25 bits are unused.</p>
</li>
<li class="data-line-445">
<p>27 bits for Page Table Entry(PTE), divided into three 9-bit chunks which are used as PTE selectors for each of the three page tables.</p>
</li>
<li class="data-line-446">
<p>12 bits for memory offset, we can select address within a page between 0-4096 bytes.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph data-line-448">
<p>Each PTE contains 44-bit (34 for Physical Page Number and 10 for flags).</p>
</div>
<div class="paragraph data-line-450">
<p>The above creates a 56 bit physical address(44 of PPN + 12 of byte offset).</p>
</div>
<div id="pagetable-addresstranslation" class="imageblock data-line-454">
<div class="content">
<img src="images/riscv_pagetable_addressTranslation.svg" alt="riscv pagetable addressTranslation">
</div>
<div class="title">Figure 12. riscv pagetable address-translation</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-456">
<h2 id="_terminology">5. Terminology</h2>
<div class="sectionbody">
<div class="paragraph data-line-457">
<p><strong>GNU</strong> is a collection of free software toola: GCC(GNU C compiler), glibc(GNU C Library), coreutils(GNU core utilities), GDB(GNU debugger), binutils(GNU binary utilities), GNU bash . GNU also has an operating system called Hurd but the most popular system "Linux" ONLY has GNU libraries with UNIX compatible tools which is often called GNU/Linux.</p>
</div>
<div class="paragraph data-line-459">
<p><strong>UNIX</strong>, is a family of operating systems that derive or behave like AT&amp;T Unix(1969). Unix and Unix-like Operating Systems have been standarized to comply with POSIX standard. The main features of Unix that allowed it to create general-purpose reusable/modular programs that can be combined to create the first "scripting language" that enable us to produce complex workflows are:</p>
</div>
<div class="ulist data-line-461">
<ul>
<li class="data-line-461">
<p>tree filesystem</p>
</li>
<li class="data-line-462">
<p>file descriptors</p>
</li>
<li class="data-line-463">
<p>pipes</p>
</li>
<li class="data-line-464">
<p>shell syntax operations</p>
</li>
</ul>
</div>
<div class="paragraph data-line-466">
<p>xv6 implements Unix-like interface.</p>
</div>
<div class="paragraph data-line-468">
<p><strong>POSIX</strong>, which stands for Portable Operating System Interface, represents a set of standards for UNIX-based operating systems. For example, having input in file descriptor 0 and output in file descriptor 1.</p>
</div>
<div class="paragraph data-line-470">
<p>However, xv6 is NOT POSIX-compliant because it misses many system calls(like lseek and others) and also does not provide the notion of users or protecting one user from another(everything is root). Modern kernels, provide many more system calls, networking, windowing systems, user-level threads, drivers but our scope is to learn the basics, so xv6 is enough and simpler than many(although conceptually is implemented as a monolithic kernel).</p>
</div>
<div class="paragraph data-line-473">
<p><strong>Linux</strong>: Its Just the GNU libraries, with many UNIX-compatible tools (compilers, editors, utilities) <strong>+ the kernel</strong> developed by Linus Torvalds(<strong>Linux</strong>)., resulting in GNU/Linux.</p>
</div>
<div class="paragraph data-line-475">
<p><strong>Licenses</strong>: General Public License: This license was created with the goal of  forbid proprietary modifications or restriction of redistribution. Free Software Foundation, want to make sure that all versions of GNU and other softwares remain free. GPL requires that source code is distributed with any binaries and that t any changes made to the source code be released under the same GPL license.</p>
</div>
<div class="paragraph data-line-477">
<p><strong>Appendix A: system calls</strong></p>
</div>
<table id="system-calls-xv6" class="tableblock frame-all grid-all stretch data-line-481">
<caption class="title">Table 2. Available system calls in xv6</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System call</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int fork()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a process, by cloning the parents file descriptor table along with its memory. returns 0 to the child process and a positive value to the parent, which contains the pid of the child.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int exit(int status)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terminate the current process; status reported to wait(). No return.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int wait(int *status)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wait for a child to exit; exit status in *status; returns child PID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int kill(int pid)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terminate process PID. Returns 0, or -1 for error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int getpid()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the current process’s PID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int sleep(int n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pause for n clock ticks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int exec(char *file, char *argv[])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">replaces the calling process’s memory with a new memory image loaded from a file stored in the file system. The file must have a particular format, which specifies which part of the file holds instructions, which part is data, at which instruction to start, etc. Xv6 uses the
ELF format; only returns if error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">char *sbrk(int n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grow process’s memory by n bytes. Returns start of new memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int open(char *file, int flags)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open a file; flags indicate read/write; returns an fd (file descriptor).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int write(int fd, char *buf, int n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write up to n bytes from buf to file descriptor fd; returns the number of bytes written.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int read(int fd, char *buf, int n)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read up to n bytes into buf; returns the number bytes readed; or 0 if end of file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int close(int fd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release open file fd.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int dup(int fd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return a new file descriptor referring to the same file as fd.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int pipe(int p[2])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a small buffer on which Writing data to one end of the pipe makes that data available for reading from the other end of the pipe via file descriptors in p[0] and p[1]. If a process tries to read before something is written to the pipe, the process is suspended until something is written.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int chdir(char *dir)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change the current directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int mkdir(char *dir)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int mknod(char *file, int, int)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a device file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int fstat(int fd, struct stat *st)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place info about an open file into *st.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int stat(char *file, struct stat *st)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place info about a named file into *st.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int link(char *file1, char *file2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create another name (file2) for the file file1.</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int unlink(char *file)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a file.</p></td>
</tr>
</tfoot>
</table>
<div class="paragraph data-line-507">
<p>Note that system calls if no otherwise stated, return 0 for no error and -1 for error.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-09-13 21:54:09 -0500
</div>
</div>
</body>
</html>